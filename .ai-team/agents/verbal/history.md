# Project Context

- **Owner:** Shayne Boyer (spboyer@live.com)
- **Project:** AI-powered slide presentation builder â€” Next.js web app with OpenAI-driven slide generation, persistent JSON storage in /presentations
- **Stack:** Next.js 15, React 19, TypeScript, Tailwind CSS, OpenAI API
- **Created:** 2026-02-10

## Learnings

<!-- Append new learnings below. Each entry is something lasting about the project. -->
- **2026-02-10 â€” Issue #2 (slide viewer/nav):** Created `SlideViewer.tsx`, `SlideNav.tsx`, and `presentation/[slug]/page.tsx`. Tailwind v4 with `@import "tailwindcss"` works fine; `prose prose-invert` classes work without `@tailwindcss/typography` plugin in Tailwind v4. react-markdown v10 uses default export. Build passes cleanly with Next.js 16 + Turbopack.
- **2026-02-10 â€” Issues #3, #5, #6 (editor, slide mgmt, landing page):** Created `PresentationList.tsx` (landing page grid with fetch/delete), `SlideEditor.tsx` (side-by-side edit + live preview), `SlideManager.tsx` (sidebar with reorder/delete). Rewrote `page.tsx` landing to use `PresentationList`. Rewrote `presentation/[slug]/page.tsx` to fetch real data from API, integrate editor toggle, slide manager sidebar, and auto-save via PUT. Next.js 16 `useParams` returns the params object directly (no `use()` needed). Build passes cleanly.

ðŸ“Œ Team update (2026-02-10): CRUD API (#8) and AI generation API (#7) are complete â€” use `getOpenAIClient()` factory, slugs max 40 chars, `await params` for Next.js 16 dynamic routes â€” decided by McManus
- **2026-02-10 â€” Issues #1, #4 (AI chat sidebar, add slides):** Created `PresentationChat.tsx` (collapsible right-side chat panel with message history, loading states, auto-scroll). Updated `SlideNav.tsx` with optional `onAddSlide`/`onAddBlank` callbacks and buttons. Rewrote `presentation/[slug]/page.tsx` to handle `/presentation/new` route (chat open by default, creates presentation via POST on first generation, replaces URL with real slug). Existing presentations get AI Chat toggle, "AI Slide" (calls generate with numSlides=1), and "Blank" add buttons in nav bar. All state changes auto-save via PUT. Build passes cleanly.

ðŸ“Œ Team update (2026-02-10): Vitest installed with 23 passing tests â€” `npm run test` available, covers types, CRUD, slugs, API exports, security â€” decided by Fenster
- **2026-02-10 â€” Issue #15 (RevealSlideshow component):** Created `RevealSlideshow.tsx` â€” a `forwardRef` client component wrapping reveal.js 5.x. Dynamic import of reveal.js in `useEffect` (requires browser globals). Theme and base CSS loaded via injected `<link>` tags from jsDelivr CDN (not static imports â€” CSS imports from `node_modules` don't work in Next.js dynamic imports). Created `src/types/reveal.d.ts` for reveal.js type declarations since the package ships no `.d.ts`. Exposed `RevealSlideshowRef` API (`goToSlide`, `next`, `prev`, `getIndices`, `toggleOverview`). Slide content auto-detects HTML vs plain text. Proper cleanup via `deck.destroy()` on unmount. Build passes cleanly. PR #26.
- **2026-02-10 â€” Issues #16, #17 (RevealSlideshow integration + ThemePicker):** Replaced `SlideViewer` with `RevealSlideshow` in `presentation/[slug]/page.tsx`. Created `ThemePicker.tsx` â€” a dropdown grid component using `<details>` for the 11 reveal.js themes from `src/lib/reveal-themes.ts`, with color preview swatches. Theme changes persist via PUT API and RevealSlideshow re-renders instantly via its CSS-swap effect. Wired `onSlideChange` callback to sync `currentSlideIndex` with reveal.js `slidechanged` event. SlideNav `onPrevious`/`onNext` now call `revealRef.current?.prev()/next()` for reveal.js navigation. SlideManager `onSelect` calls `goToSlide()`. Added fullscreen toggle, overview button, and speaker notes hint to top bar. Keyboard coordination: SlideNav skips arrow key handling when reveal.js container is focused (`keyboardCondition: "focused"`). Build passes cleanly. PR #28.
ðŸ“Œ Team update (2026-02-10): Never include secrets in GitHub issues, PRs, or repo content â€” directive by Shayne Boyer
ðŸ“Œ Team update (2026-02-10): Always update docs, tests, and agents.md when making changes â€” directive by Shayne Boyer
ðŸ“Œ Team update (2026-02-10): AI prompt now generates auto-animate, r-fit-text, rich fragments, code line highlighting, background gradients â€” new `autoAnimate` and `backgroundGradient` fields on Slide type â€” decided by McManus
- **2026-02-10 â€” Issues #32, #33, #34 (CSS conflicts, plugins, overview):** Added `all: revert` CSS rules scoped to `.reveal .slides` for all HTML elements to undo Tailwind v4 resets â€” works for all 11 reveal.js themes. Imported RevealHighlight, RevealNotes, RevealZoom plugins via dynamic import and registered them in the deck config. Loaded highlight.js Monokai CSS from jsDelivr CDN with cleanup on unmount. Added `overviewhidden` event listener so `currentSlideIndex` syncs when leaving overview mode. Updated `src/types/reveal.d.ts` with plugin module declarations and `plugins` option. Build passes, 50 tests pass.
ðŸ“Œ Team update (2026-02-10): Playwright e2e tests available via `npm run test:e2e` â€” use `e2e/helpers.ts` for fixtures, follow skip pattern for API-dependent tests â€” decided by Fenster
- **2026-02-10 â€” Issue #35 (Wire editor styles end-to-end):** Applied `layout` field in `RevealSlideshow.tsx` `sectionAttrs()` â€” `center` layout adds `data-state="center"` and `center` class to `<section>`, `two-column` wraps content in `r-hstack` div. Added `autoAnimate` checkbox toggle and `backgroundGradient` text input to `SlideEditor.tsx`. Both new fields included in preview slide object and `handleSave()` for full round-trip persistence. Build passes, 50 tests pass. PR #52.
- **2026-02-10 â€” fitty/r-fit-text crash fix:** reveal.js uses fitty internally for `r-fit-text` CSS class. Fitty runs a `requestAnimationFrame` loop measuring `.clientWidth` on DOM elements. During React Strict Mode double-invocation or component remount, fitty holds stale references to detached DOM nodes and throws `TypeError: Cannot read properties of null (reading 'clientWidth')`. The crash is inside fitty's bundled rAF loop â€” cannot be caught with try-catch. Fix: added `stripFitText()` utility in `RevealSlideshow.tsx` that removes `r-fit-text` from HTML content before rendering via `dangerouslySetInnerHTML`. Headings still render correctly via CSS revert rules â€” just without fitty's auto-sizing. Build passes, 50 tests pass.
- **2026-02-10 â€” CSS scoping fix (all: revert â†’ targeted reverts):** The `all: revert` rule on 30+ elements inside `.reveal .slides` was nuking reveal.js theme styles. All themes (night, moon, black, etc.) use CSS custom properties (`--r-heading-font`, `--r-heading1-size`, `--r-main-color`, etc.) applied via `.reveal h1`, `.reveal ul`, `.reveal pre` selectors. `all: revert` reverted every property to browser defaults, wiping theme fonts, colors, heading sizes, letter-spacing, text-transforms, blockquote styling, code block styling, and fragment animations. Fix: replaced `all: revert` with targeted `revert` on only the specific properties Tailwind v4 resets (margin, padding, list-style, font-size, font-weight, font-family, border, text-decoration, color, etc.). Also added: (1) r-fit-text replacement CSS so standalone title headings render at 2.5â€“3em, (2) fragment animation preservation for opacity/transform/visibility/transition, (3) code block property reverts for font-family/font-size/margin. Build passes, 50 tests pass.
ðŸ“Œ Team update (2026-02-10): SYSTEM_PROMPT V2 deployed â€” 8-type slide taxonomy, strict HTML rules, curated backgrounds, theme intelligence â€” decided by McManus
ðŸ“Œ Team update (2026-02-10): Console error detection e2e tests added â€” `page.on('pageerror')` catches uncaught JS errors during Playwright runs â€” decided by Fenster
ðŸ“Œ Team update (2026-02-10): r-fit-text removed from AI prompt and stripped from rendering â€” fitty crash eliminated â€” decided by McManus & Verbal
- **2026-02-10 â€” Default theme locked in (black):** Set `black` as the one and only default theme with `slide` transition across all components: `RevealSlideshow.tsx` fallback, `page.tsx` ThemePicker default, `route.ts` SYSTEM_PROMPT default suggestion, and showcase presentation JSON. Fixed CSS: removed heading `font-size: revert`/`font-weight: revert`/`margin: revert` from `.reveal .slides h1-h6` â€” these were at higher specificity (0,2,1) than the theme's `.reveal h1` rules (0,1,1), causing theme heading sizes/weights/margins to be overridden with UA defaults instead of the theme's CSS custom property values. Created 8-slide self-referential showcase presentation (`untitled-presentation.json`) demonstrating: cover with gradient, impact statement, fragment bullets, code with line highlighting, comparison table, blockquote, auto-animate pair. Build passes, 50 unit tests pass, 34 e2e tests pass.
