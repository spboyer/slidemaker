# Project Context

- **Owner:** Shayne Boyer (spboyer@live.com)
- **Project:** AI-powered slide presentation builder â€” Next.js web app with OpenAI-driven slide generation, persistent JSON storage in /presentations
- **Stack:** Next.js 15, React 19, TypeScript, Tailwind CSS, OpenAI API
- **Created:** 2026-02-10

## Learnings

<!-- Append new learnings below. Each entry is something lasting about the project. -->

### Summary: 2026-02-10 â€” Issues #2, #3, #5, #6, #1, #4 (Core UI)
Built all frontend components: `SlideViewer.tsx` (presentational, parent owns state), `SlideNav.tsx` (keyboard nav, optional add buttons), `SlideEditor.tsx` (side-by-side edit+preview), `SlideManager.tsx` (sidebar reorder/delete), `PresentationList.tsx` (landing page grid), `PresentationChat.tsx` (collapsible right-side chat panel). Tailwind v4 includes typography utilities natively (`prose prose-invert`). Next.js 16 `useParams` returns params directly. `/presentation/new` handled by `[slug]/page.tsx` â€” creates via POST on first AI generation, replaces URL with slug. All mutations auto-save via PUT.

ðŸ“Œ Team update (2026-02-10): CRUD API (#8) and AI generation API (#7) are complete â€” use `getOpenAIClient()` factory, slugs max 40 chars, `await params` for Next.js 16 dynamic routes â€” decided by McManus
ðŸ“Œ Team update (2026-02-10): Vitest installed with 23 passing tests â€” `npm run test` available, covers types, CRUD, slugs, API exports, security â€” decided by Fenster

### Summary: 2026-02-10 â€” Issues #15, #16, #17 (reveal.js Integration)
Created `RevealSlideshow.tsx` â€” `forwardRef` client component wrapping reveal.js 5.x via dynamic import. CSS loaded via `<link>` tags from jsDelivr CDN (not static imports). Created `src/types/reveal.d.ts` for ambient declarations. Replaced `SlideViewer` with `RevealSlideshow` in main presentation view. Created `ThemePicker.tsx` using `<details>` dropdown. Keyboard coordination: `keyboardCondition: "focused"` in reveal.js, SlideNav skips when reveal focused. Added fullscreen, overview, speaker notes to top bar.

ðŸ“Œ Team update (2026-02-10): Never include secrets in GitHub issues, PRs, or repo content â€” directive by Shayne Boyer
ðŸ“Œ Team update (2026-02-10): Always update docs, tests, and agents.md when making changes â€” directive by Shayne Boyer

### Summary: 2026-02-10 â€” Issues #32â€“35 (CSS + Plugins + Editor Wiring)
Added reveal.js plugins (Highlight, Notes, Zoom) via dynamic import. Loaded highlight.js Monokai CSS from CDN. Added `overviewhidden` event sync. Applied `layout`, `autoAnimate`, `backgroundGradient` fields in `sectionAttrs()`. Added editor controls for autoAnimate checkbox and backgroundGradient input.

ðŸ“Œ Team update (2026-02-10): AI prompt now generates auto-animate, r-fit-text, rich fragments, code line highlighting, background gradients â€” new `autoAnimate` and `backgroundGradient` fields on Slide type â€” decided by McManus
ðŸ“Œ Team update (2026-02-10): Playwright e2e tests available via `npm run test:e2e` â€” use `e2e/helpers.ts` for fixtures, follow skip pattern for API-dependent tests â€” decided by Fenster

### 2026-02-10 â€” fitty/r-fit-text crash fix
reveal.js uses fitty internally for `r-fit-text`. Fitty's `requestAnimationFrame` loop crashes with `TypeError: Cannot read properties of null (reading 'clientWidth')` during React reconciliation. Fix: `stripFitText()` removes class before rendering. Headings render correctly via CSS revert rules.

### 2026-02-10 â€” CSS scoping fix (all: revert â†’ targeted reverts)
`all: revert` on 30+ elements was destroying theme styles. Replaced with targeted `revert` on only Tailwind-reset properties (margin, padding, font-size, font-weight, font-family, list-style, border, text-decoration, color). Removed fragment animation reverts. All 11 themes render correctly.

ðŸ“Œ Team update (2026-02-10): SYSTEM_PROMPT V2 deployed â€” 8-type slide taxonomy, strict HTML rules, curated backgrounds, theme intelligence â€” decided by McManus
ðŸ“Œ Team update (2026-02-10): Console error detection e2e tests added â€” `page.on('pageerror')` catches uncaught JS errors during Playwright runs â€” decided by Fenster
ðŸ“Œ Team update (2026-02-10): r-fit-text removed from AI prompt and stripped from rendering â€” fitty crash eliminated â€” decided by McManus & Verbal
- **2026-02-10 â€” Default theme locked in (black):** Set `black` as the one and only default theme with `slide` transition across all components: `RevealSlideshow.tsx` fallback, `page.tsx` ThemePicker default, `route.ts` SYSTEM_PROMPT default suggestion, and showcase presentation JSON. Fixed CSS: removed heading `font-size: revert`/`font-weight: revert`/`margin: revert` from `.reveal .slides h1-h6` â€” these were at higher specificity (0,2,1) than the theme's `.reveal h1` rules (0,1,1), causing theme heading sizes/weights/margins to be overridden with UA defaults instead of the theme's CSS custom property values. Created 8-slide self-referential showcase presentation (`untitled-presentation.json`) demonstrating: cover with gradient, impact statement, fragment bullets, code with line highlighting, comparison table, blockquote, auto-animate pair. Build passes, 50 unit tests pass, 34 e2e tests pass.
- **2026-02-10 â€” Viewport background/color override fix:** Playwright computed style inspection revealed three cascade issues: (1) `.reveal-viewport` background was white (#fff) instead of theme's `--r-background-color` (#191919) â€” Tailwind's `:root { --background: #fff }` cascaded through body and won. (2) Text color was black (#171717) from `--foreground` instead of theme's `--r-main-color` (#fff). (3) h2 titles were 105px (2.5em Ã— 42px) due to `.reveal .slides section h2:first-child:last-of-type` at specificity (0,4,1) beating theme's `.reveal h2` at (0,1,1). Fix: added `.reveal-viewport { background-color: var(--r-background-color) !important; color: var(--r-main-color) !important }` and `.reveal { color: var(--r-main-color) !important; font-family: var(--r-main-font) !important }` to globals.css. Removed all r-fit-text replacement heading rules â€” theme already sizes headings correctly via `--r-heading1-size`/`--r-heading2-size`. The `!important` is justified to beat the Tailwind body cascade. Build passes, 50 unit tests pass, 34 e2e tests pass. Key learning: when reveal.js themes set CSS custom properties on `:root`, Tailwind's own `:root` variables for body background/color cascade through and override the theme's `.reveal-viewport` rules at equal specificity â€” explicit `!important` overrides in globals.css are the correct fix.
- **2026-02-10 â€” Code block rendering fix:** Three CSS fixes in `globals.css`: (1) Removed `font-size: revert` on `.reveal .slides pre` and `.reveal .slides code` â€” `revert` goes to UA default `inherit`, which picks up `.reveal`'s 42px base font, making code 42px instead of ~23px. Theme's `.reveal pre { font-size: 0.55em }` at (0,1,1) now wins correctly. (2) Added explicit `background: #3f3f3f`, `padding: 20px`, `border-radius: 8px`, `overflow: auto`, `box-shadow` to `.reveal .slides pre` â€” Tailwind strips pre backgrounds, and without highlight.js activation the code block was fully transparent with no padding. (3) Removed `.reveal .slides .fragment { opacity: revert; transform: revert; visibility: revert; transition: revert; }` â€” reveal.js sets fragments to `opacity: 0` initially and animates them in; `revert` set opacity to 1 (visible), breaking all fragment animations. Key learning: never use `font-size: revert` on elements inside `.reveal` â€” the UA default for pre/code font-size is `inherit`, which inherits the 42px base from `.reveal`, not the expected browser monospace sizing. Build passes, 50 unit tests pass, 34 e2e tests pass.
- **2026-02-10 â€” highlight.js activation fix:** The `RevealHighlight` plugin processes `<pre><code>` during `deck.initialize()`, adding `hljs` class, `data-highlighted` attribute, syntax-colored `<span>` elements, and line-number tables. However, `setReady(true)` after init triggers a React re-render, and React's `dangerouslySetInnerHTML` reconciliation replaces the plugin-modified DOM with the original `slide.content` HTML, stripping all highlighting. Fix: added `highlightCodeBlocks()` utility that queries `pre code:not([data-highlighted])`, adds `code-wrapper` to parent `<pre>`, and calls `plugin.highlightBlock(block)` using the plugin's own bundled hljs instance via `deck.getPlugin('highlight')`. Called from a `useEffect` dependent on `ready` state (runs after the re-render), and also after `deck.sync()` for dynamic content changes. Key learning: any React state change after reveal.js plugin processing will cause `dangerouslySetInnerHTML` to re-render and wipe plugin DOM modifications â€” always re-apply plugin effects after state-triggered re-renders. Build passes, 50 unit tests pass, 34 e2e tests pass.
ðŸ“Œ Team update (2026-02-10): Three CSS rendering fixes â€” viewport bg/color !important override, code block font-size/styling fix, hljs post-render re-highlighting â€” all verified via Playwright â€” decided by Verbal
